function [r, v] = p2000b(ip, jdate)    

% planetary ephemeris

% input

%  ip    = planet index (1 = mercury, 2 = venus, etc.)
%  jdate = julian date

% output

%  r = heliocentric position vector (kilometers)
%  v = heliocentric velocity vector (kilometers/second)

% Note: coordinates are with respect to the
%       ecliptic and equinox of J2000.

% Orbital Mechanics with MATLAB

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

global mu

% gravitational constant of the sun (km^3/sec^2)

mu = 132712441933;      

% astronomical unit (kilometers)

aunit = 149597870.66;

% degrees to radians

dtr = pi / 180;

% time arguments

t = (jdate - 2451545) / 36525;

t2 = t * t;
t3 = t * t2;

% evaluate orbital elements for selected planet

switch ip
case 1
   % mercury   
   sma   =  0.387098310;
   ecc   =  0.20563175 + 0.000020406 * t - 0.0000000284 * t2 - 0.00000000017 * t3;
   inc   =  7.004986 - 0.0059516 * t + 0.00000081 * t2 + 0.000000041 * t3;
   mlong =  252.250906 + 149472.6746358 * t - 0.00000535 * t2 + 0.000000002 * t3;
   raan  =  48.330893 - 0.1254229 * t - 0.00008833 * t2 - 0.000000196 * t3;
   lper  =  77.456119 + 0.1588643 * t - 0.00001343 * t2 + 0.000000039 * t3;
case 2
   % venus
   sma   =  0.723329820;
   ecc   =  0.00677188 - 0.000047766 * t + 0.0000000975 * t2 + 0.00000000044 * t3;
   inc   =  3.394622 - 0.0008568 * t - 0.00003244 * t2 + 0.000000010 * t3;
   mlong =  181.979801 + 58517.815676 * t + 0.00000165 * t2 - 0.000000002 * t3;
   raan  =  76.679920 - 0.2780080 * t - 0.00014256 * t2 - 0.000000198 * t3;
   lper  =  131.563707 + 0.0048646 * t - 0.00138232 * t2 - 0.000005332 * t3;
case 3
   % earth
   sma   =  1.000001018;
   ecc   =  0.01670862 - 0.000042037 * t - 0.0000001236 * t2 + 0.00000000004 * t3;
   inc   =  0 + 0.0130546 * t - 0.00000931 * t2 - 0.000000034 * t3;
   mlong =  100.466449 + 35999.3728519 * t - 0.00000568 * t2 - 0.000000000 * t3;
   raan  =  174.873174 - 0.2410908 * t + 0.00004067 * t2 - 0.000001327 * t3;
   lper  =  102.937348 + 0.3225557 * t + 0.00015026 * t2 + 0.000000478 * t3;
case 4
   % mars
   sma   =  1.523679342;
   ecc   =  0.09340062 + 0.000090483 * t - 0.0000000806 * t2 - 0.00000000035 * t3;
   inc   =  1.849726 - 0.0081479 * t - 0.00002255 * t2 - 0.000000027 * t3;
   mlong =  355.433275 + 19140.2993313 * t + 0.00000261 * t2 - 0.000000003 * t3;
   raan  =  49.558093 - 0.2949846 * t - 0.00063993 * t2 - 0.000002143 * t3;
   lper  =  336.060234 + 0.4438898 * t - 0.00017321 * t2 + 0.000000300 * t3;
case 5
   % jupiter
   sma   =  5.202603191 + 0.0000001913 * t;
   ecc   =  0.04849485 + 0.000163244 * t - 0.0000004719 * t2 - 0.00000000197 * t3;
   inc   =  1.303270 - 0.0019872 * t + 0.00003318 * t2 + 0.000000092 * t3;
   mlong =  34.351484 + 3034.9056746 * t - 0.00008501 * t2 + 0.000000004 * t3;
   raan  =  100.464441 + 0.1766828 * t + 0.00090387 * t2 - 0.000007032 * t3;
   lper  =  14.331309 + 0.2155525 * t + 0.00072252 * t2 - 0.000004590 * t3;
case 6
   % saturn
   sma   =  9.554909596 - 0.0000021389 * t;
   ecc   =  0.05550862 - 0.000346818 * t - 0.0000006456 * t2 + 0.00000000338 * t3;
   inc   =  2.488878 + 0.0025515 * t - 0.00004903 * t2 + 0.000000018 * t3;
   mlong =  50.077471 + 1222.1137943 * t + 0.00021004 * t2 - 0.000000019 * t3;
   raan  =  113.665524 - 0.2566649 * t - 0.00018345 * t2 + 0.000000357 * t3;
   lper  =  93.056787 + 0.5665496 * t2 + 0.00052809 * t2 + 0.000004882 * t3;
case 7
   % uranus
   sma   =  19.218446062 - 0.0000000372 * t + 0.00000000098 * t2;
   ecc   =  0.04629590 - 0.000027337 * t + 0.0000000790 * t2 + 0.00000000025 * t3;
   inc   =  0.773196 - 0.0016869 * t + 0.00000349 * t2 + 0.000000016 * t3;
   mlong =  314.055005 + 428.4669983 * t - 0.00000486 * t2 + 0.000000006 * t3;
   raan  =  74.005947 + 0.0741461 * t + 0.00040540 * t2 + 0.000000104 * t3;
   lper  =  173.005159 + 0.0893206 * t - 0.00009470 * t2 + 0.000000413 * t3;
case 8
   % neptune
   sma   =  30.110386869 - 0.0000001663 * t + 0.00000000069 * t2;
   ecc   =  0.00898809 + 0.000006408 * t - 0.0000000008 * t2 - 0.00000000005 * t3;
   inc   =  1.769952 + 0.0002257 * t + 0.00000023 * t2 - 0.000000000 * t3;
   mlong =  304.348665 + 218.4862002 * t + 0.00000059 * t2 - 0.000000002 * t3;
   raan  =  131.784057 - 0.0061651 * t - 0.00000219 * t2 - 0.000000078 * t3;
   lper  =  48.123691 + 0.0291587 * t + 0.00007051 * t2 - 0.000000023 * t3;
end

% argument of perihelion (radians)

argper = modulo(dtr * (lper - raan));

% mean anomaly (radians)

xma = modulo(dtr * (mlong - lper));

% solve Kepler's equation

[eanom, tanom] = kepler1(xma, ecc);

% load orbital elements array

oev(1) = aunit * sma;
oev(2) = ecc;
oev(3) = dtr * inc;
oev(4) = argper;
oev(5) = modulo(dtr * raan);
oev(6) = tanom;

% determine heliocentric state vector

[r, v] = orb2eci(oev);


